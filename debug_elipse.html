<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Elipse LaTeX</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
            processEscapes: true,
            processEnvironments: true
        },
        options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
        }
    };
    </script>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">üêõ Debug: Elipse LaTeX Issues</h1>
        
        <div class="alert alert-warning">
            <h4>Debugging Steps:</h4>
            <ol>
                <li>Load exact ellipse content from script1.js</li>
                <li>Apply validation functions step by step</li>
                <li>Test different LaTeX formats</li>
                <li>Verify MathJax processing</li>
            </ol>
        </div>

        <!-- Step 1: Original Content -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>üìÑ Step 1: Raw HTML Content (como aparece en script1.js)</h5>
            </div>
            <div class="card-body">
                <div id="step1-original" style="border: 1px solid #ccc; padding: 10px; background: #f8f9fa;">
                    <!-- Se llenar√° con el contenido exacto -->
                </div>
            </div>
        </div>

        <!-- Step 2: After validateElipseFormulas -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>üîß Step 2: After validateElipseFormulas</h5>
            </div>
            <div class="card-body">
                <div id="step2-validated" style="border: 1px solid #ccc; padding: 10px; background: #e8f5e8;">
                    <!-- Se llenar√° despu√©s de validaci√≥n espec√≠fica -->
                </div>
            </div>
        </div>

        <!-- Step 3: After Full Validation -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>‚úÖ Step 3: After Full validateAndFixAllMathFormulasWithAlternatives</h5>
            </div>
            <div class="card-body">
                <div id="step3-full-validated" style="border: 1px solid #ccc; padding: 10px; background: #fff3cd;">
                    <!-- Se llenar√° despu√©s de validaci√≥n completa -->
                </div>
            </div>
        </div>

        <!-- Step 4: After MathJax -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>üéØ Step 4: After MathJax Processing</h5>
            </div>
            <div class="card-body">
                <div id="step4-mathjax" style="border: 1px solid #ccc; padding: 10px; background: #d4edda;">
                    <!-- Se llenar√° despu√©s de MathJax -->
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="text-center mb-4">
            <button class="btn btn-primary" onclick="runStep1()">üìÑ Step 1: Load Original</button>
            <button class="btn btn-warning" onclick="runStep2()">üîß Step 2: Validate Elipse</button>
            <button class="btn btn-info" onclick="runStep3()">‚úÖ Step 3: Full Validation</button>
            <button class="btn btn-success" onclick="runStep4()">üéØ Step 4: MathJax</button>
            <button class="btn btn-dark" onclick="runAllSteps()">üöÄ Run All Steps</button>
        </div>

        <!-- Debug Log -->
        <div class="card">
            <div class="card-header">
                <h5>üìã Debug Log</h5>
            </div>
            <div class="card-body">
                <div id="debug-log" style="max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 0.9em;">
                    <!-- Log messages aparecer√°n aqu√≠ -->
                </div>
            </div>
        </div>
    </div>

    <script src="js/script1.js"></script>
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-primary',
                success: 'text-success', 
                warning: 'text-warning',
                error: 'text-danger'
            };
            logDiv.innerHTML += `<div class="${colors[type]}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function runStep1() {
            log('üìÑ STEP 1: Loading original content from script1.js...', 'info');
            
            // Contenido exacto como aparece en script1.js (con escapes)
            const originalContent = `
                <div class="ellipse-tool">
                    <h2 class="main-title">Concepto de Elipse</h2>
                    
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h4>Definici√≥n como lugar geom√©trico:</h4>
                                    <p class="mb-3">Se llama elipse al lugar geom√©trico de todos los puntos $P(x,y)$ que se mueven en 
                                    el plano, tal que la suma de las distancias de $P(x,y)$ a dos puntos fijos $F_1$ y $F_2$ (llamados focos) es constante.</p>
                                    
                                    <div class="math-equation mb-3">
                                        <strong>Definici√≥n formal:</strong> 
                                        $$d(P,F_1) + d(P,F_2) = 2a$$
                                        $$\\\\sqrt{(x-h+c)^2 + (y-k)^2} + \\\\sqrt{(x-h-c)^2 + (y-k)^2} = 2a$$
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('step1-original').innerHTML = originalContent;
            log('‚úÖ Original content loaded', 'success');
        }

        function runStep2() {
            log('üîß STEP 2: Applying validateElipseFormulas...', 'warning');
            
            const step1 = document.getElementById('step1-original');
            const step2 = document.getElementById('step2-validated');
            
            // Copy content from step 1
            step2.innerHTML = step1.innerHTML;
            
            try {
                // Apply ellipse-specific validation
                if (typeof app.validateElipseFormulas === 'function') {
                    app.validateElipseFormulas(step2);
                    log('‚úÖ validateElipseFormulas applied successfully', 'success');
                } else {
                    log('‚ùå validateElipseFormulas function not found', 'error');
                }
            } catch (error) {
                log(`‚ùå Error in validateElipseFormulas: ${error.message}`, 'error');
            }
        }

        function runStep3() {
            log('‚úÖ STEP 3: Applying full validation...', 'info');
            
            const step2 = document.getElementById('step2-validated');
            const step3 = document.getElementById('step3-full-validated');
            
            // Copy content from step 2
            step3.innerHTML = step2.innerHTML;
            
            try {
                // Apply full validation
                if (typeof app.validateAndFixAllMathFormulasWithAlternatives === 'function') {
                    app.validateAndFixAllMathFormulasWithAlternatives(step3);
                    log('‚úÖ Full validation applied successfully', 'success');
                } else {
                    log('‚ùå validateAndFixAllMathFormulasWithAlternatives function not found', 'error');
                }
            } catch (error) {
                log(`‚ùå Error in full validation: ${error.message}`, 'error');
            }
        }

        function runStep4() {
            log('üéØ STEP 4: Applying MathJax processing...', 'success');
            
            const step3 = document.getElementById('step3-full-validated');
            const step4 = document.getElementById('step4-mathjax');
            
            // Copy content from step 3
            step4.innerHTML = step3.innerHTML;
            
            try {
                // Apply MathJax processing
                if (typeof MathJax !== "undefined" && MathJax.typesetPromise) {
                    MathJax.typesetPromise([step4]).then(() => {
                        log('‚úÖ MathJax processing completed successfully', 'success');
                    }).catch((err) => {
                        log(`‚ùå MathJax error: ${err.message}`, 'error');
                    });
                } else {
                    log('‚ö†Ô∏è MathJax not available or wrong version', 'warning');
                }
            } catch (error) {
                log(`‚ùå Error in MathJax processing: ${error.message}`, 'error');
            }
        }

        function runAllSteps() {
            log('üöÄ Running all debugging steps...', 'info');
            runStep1();
            setTimeout(runStep2, 500);
            setTimeout(runStep3, 1000);
            setTimeout(runStep4, 1500);
        }

        // Auto-start debugging when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                log('üåü Debug tool loaded - ready to analyze ellipse LaTeX issues', 'info');
                log('Click "Run All Steps" to see the complete process', 'info');
            }, 1000);
        });
    </script>
</body>
</html>
