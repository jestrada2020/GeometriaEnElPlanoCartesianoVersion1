<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Circle Sqrt Fix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    
    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true,
                processRefs: true,
                tags: 'ams',
                tagSide: 'right',
                tagIndent: '.8em',
                multlineWidth: '85%',
                macros: {
                    sqrt: ['\\sqrt{#1}', 1]
                }
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process',
                renderActions: {
                    findScript: [10, function (doc) {
                        for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                            const display = !!node.type.match(/; *mode=display/);
                            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                            const text = document.createTextNode('');
                            node.parentNode.replaceChild(text, node);
                            math.start = {node: text, delim: '', n: 0};
                            math.end = {node: text, delim: '', n: 0};
                            doc.math.push(math);
                        }
                    }, '']
                }
            },
            startup: {
                typeset: false,
                ready: function () {
                    MathJax.startup.defaultReady();
                    console.log('MathJax is ready');
                }
            },
            loader: {
                load: ['[tex]/ams', '[tex]/noerrors', '[tex]/noundefined']
            }
        };
        
        // Función para recargar MathJax
        function reprocessMathJax() {
            if (window.MathJax && window.MathJax.typesetPromise) {
                return window.MathJax.typesetPromise();
            }
            return Promise.resolve();
        }
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h1>Test Circle Sqrt Expressions</h1>
        
        <!-- Test 1: Basic sqrt -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Test 1: Basic sqrt format</h3>
            </div>
            <div class="card-body">
                <p>Basic sqrt expression: $$\sqrt{x^2 + y^2}$$</p>
                <p>Circle equation: $$\sqrt{(x-h)^2 + (y-k)^2} = r$$</p>
            </div>
        </div>
        
        <!-- Test 2: Circle tool content simulation -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Test 2: Circle Tool Content (Simulated)</h3>
            </div>
            <div class="card-body" id="circle-content">
                <div class="circle-tool">
                    <h4>Definición como lugar geométrico:</h4>
                    <p class="mb-3">Se llama círculo al lugar geométrico de todos los puntos $P(x,y)$ que se mueven en 
                    el plano, de forma que su distancia a un punto fijo $C(h,k)$ (llamado centro) es siempre constante. 
                    La constante se llama radio $r > 0$.</p>
                    
                    <div class="math-equation mb-3">
                        <strong>Definición formal:</strong> 
                        $$d(P,C) = r$$
                        $$\sqrt{(x-h)^2 + (y-k)^2} = r$$
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Test 3: Validation test -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Test 3: Validation Function Test</h3>
            </div>
            <div class="card-body">
                <button class="btn btn-primary" onclick="testValidation()">Apply Validation Functions</button>
                <div id="validation-content" class="mt-3">
                    <p>Raw sqrt: sqrt{(x-h)^2 + (y-k)^2} = r</p>
                    <p>Double escaped: \\sqrt{(x-h)^2 + (y-k)^2} = r</p>
                    <p>Mixed format: sqrt((x-h)^2 + (y-k)^2) = r</p>
                </div>
            </div>
        </div>
        
        <!-- Status -->
        <div class="alert alert-info">
            <strong>Status:</strong> Page loaded. Check if sqrt expressions render as mathematical symbols or raw text.
        </div>
    </div>

    <!-- Load validation functions -->
    <script src="js/script1.js"></script>
    
    <script>
        // Test validation function
        function testValidation() {
            const validationContent = document.getElementById('validation-content');
            
            // Apply the validation functions like in the main app
            if (window.app && window.app.validateAndFixSqrtFormulas) {
                console.log('Applying validateAndFixSqrtFormulas...');
                window.app.validateAndFixSqrtFormulas(validationContent);
                
                setTimeout(() => {
                    if (window.app.validateAndFixAllMathFormulasWithAlternatives) {
                        console.log('Applying validateAndFixAllMathFormulasWithAlternatives...');
                        window.app.validateAndFixAllMathFormulasWithAlternatives(validationContent);
                    }
                    
                    setTimeout(() => {
                        if (window.app.reprocessMathJaxGlobal) {
                            console.log('Reprocessing MathJax...');
                            window.app.reprocessMathJaxGlobal();
                        } else {
                            console.log('Fallback MathJax reprocess...');
                            reprocessMathJax();
                        }
                    }, 150);
                }, 50);
            } else {
                console.log('Validation functions not available');
                // Fallback reprocess
                reprocessMathJax();
            }
        }
        
        // Auto-apply validation on page load
        window.addEventListener('load', function() {
            setTimeout(testValidation, 1000);
        });
    </script>
</body>
</html>
