<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Elipse LaTeX Fix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
            processEscapes: true,
            processEnvironments: true
        },
        options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
        }
    };
    </script>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">üîç Test: Elipse LaTeX Fix</h1>
        
        <div class="alert alert-info">
            <h4>Problema:</h4>
            <p>La definici√≥n de la elipse muestra f√≥rmulas LaTeX sin renderizar (c√≥digo crudo)</p>
        </div>

        <!-- Test Original -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>‚ùå Problema Original (Raw LaTeX)</h5>
            </div>
            <div class="card-body">
                <div class="math-equation mb-3" id="original-test">
                    <strong>Definici√≥n formal:</strong> 
                    $$d(P,F_1) + d(P,F_2) = 2a$$
                    $$\sqrt{(x-h+c)^2 + (y-k)^2} + \sqrt{(x-h-c)^2 + (y-k)^2} = 2a$$
                </div>
            </div>
        </div>

        <!-- Test Fixed -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>‚úÖ Despu√©s de la Validaci√≥n</h5>
            </div>
            <div class="card-body">
                <div class="math-equation mb-3" id="fixed-test">
                    <!-- Se llenar√° despu√©s de la validaci√≥n -->
                </div>
            </div>
        </div>

        <!-- Test CSS Alternative -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>üé® Alternativa CSS (Backup)</h5>
            </div>
            <div class="card-body">
                <div id="css-alternative-test">
                    <!-- Se llenar√° con alternativa CSS -->
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="text-center mb-4">
            <button class="btn btn-primary" onclick="testValidation()">üîß Aplicar Validaci√≥n</button>
            <button class="btn btn-warning" onclick="testCSSAlternative()">üé® Mostrar CSS Alternative</button>
            <button class="btn btn-success" onclick="testFullProcess()">üöÄ Proceso Completo</button>
        </div>

        <!-- Results -->
        <div class="alert alert-secondary">
            <h5>üìä Resultados del Test:</h5>
            <div id="test-results">
                <p>Haz clic en los botones arriba para ejecutar los tests</p>
            </div>
        </div>
    </div>

    <script src="js/script1.js"></script>
    <script>
        function logResult(message, success = true) {
            const results = document.getElementById('test-results');
            const icon = success ? '‚úÖ' : '‚ùå';
            const color = success ? 'text-success' : 'text-danger';
            results.innerHTML += `<p class="${color}">${icon} ${message}</p>`;
        }

        function testValidation() {
            console.log('üîß Probando validaci√≥n de f√≥rmulas...');
            
            const originalElement = document.getElementById('original-test');
            const fixedElement = document.getElementById('fixed-test');
            
            // Copiar contenido original
            fixedElement.innerHTML = originalElement.innerHTML;
            
            try {
                // Aplicar validaci√≥n
                app.validateAndFixAllMathFormulasWithAlternatives(fixedElement);
                logResult('Validaci√≥n aplicada exitosamente');
                
                // Re-procesar con MathJax
                setTimeout(() => {
                    if (typeof MathJax !== "undefined") {
                        if (MathJax.typesetPromise) {
                            MathJax.typesetPromise([fixedElement]).then(() => {
                                logResult('MathJax re-procesado correctamente');
                            });
                        }
                    }
                }, 100);
                
            } catch (error) {
                logResult(`Error en validaci√≥n: ${error.message}`, false);
            }
        }

        function testCSSAlternative() {
            console.log('üé® Probando alternativa CSS...');
            
            try {
                // Crear ecuaciones usando CSS alternatives
                const equations1 = ['d(P,F‚ÇÅ) + d(P,F‚ÇÇ) = 2a'];
                const equations2 = ['‚àö((x-h+c)¬≤ + (y-k)¬≤) + ‚àö((x-h-c)¬≤ + (y-k)¬≤) = 2a'];
                
                const css1 = app.casesGrid(equations1);
                const css2 = app.casesSVG(equations2);
                
                const cssContainer = document.getElementById('css-alternative-test');
                cssContainer.innerHTML = `
                    <h6>CSS Grid Alternative:</h6>
                    ${css1}
                    <h6 class="mt-3">CSS SVG Alternative:</h6>
                    ${css2}
                `;
                
                logResult('CSS alternatives generadas exitosamente');
            } catch (error) {
                logResult(`Error en CSS alternatives: ${error.message}`, false);
            }
        }

        function testFullProcess() {
            console.log('üöÄ Probando proceso completo...');
            
            // Limpiar resultados
            document.getElementById('test-results').innerHTML = '<h6>Proceso Completo:</h6>';
            
            // Ejecutar en secuencia
            setTimeout(testValidation, 100);
            setTimeout(testCSSAlternative, 500);
            setTimeout(() => {
                logResult('‚ú® Proceso completo finalizado - verifica los resultados arriba');
            }, 1000);
        }

        // Auto-test inicial
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                logResult('üåü Test cargado - las f√≥rmulas de arriba deber√≠an mostrar el problema');
                
                // Verificar que las funciones existen
                const functions = ['validateAndFixAllMathFormulasWithAlternatives', 'casesGrid', 'casesSVG'];
                functions.forEach(fn => {
                    if (typeof app[fn] === 'function') {
                        logResult(`Funci√≥n app.${fn} disponible`);
                    } else {
                        logResult(`Funci√≥n app.${fn} NO encontrada`, false);
                    }
                });
            }, 1000);
        });
    </script>
</body>
</html>
